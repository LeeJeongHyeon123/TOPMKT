# 탑마케팅 서비스 기획서 (Rev8.2)

**문서 버전:** v2.5 (Rev9.0)  
**최종 수정일:** 2025-06-09 21:50:00 KST

---

## 변경 이력
- **v2.5 (Rev9.0, 2025-06-09 21:50:00 KST)**  
  - 완료된 기능들 상태 업데이트: 강의 시스템, 댓글 시스템, 행사 일정 등 완료 반영  
  - 파비콘 및 브랜딩 시스템 완료 상태 반영  
  - 대용량 페이지네이션 최적화 및 성능 개선 사항 추가  
  - 최신 기술 스택 및 구현 현황 업데이트  
- **v2.4 (Rev8.2, 2025-05-31 12:00:00 KST)**  
  - 개발 우선순위(1차/2차) 섹션 추가  
  - “도메인/프로토콜/환경” 정보 명시 (`www.topmktx.com`, HTTPS, CentOS 7.9, Apache/2.4.6, PHP 8.0.30, MariaDB 10.6.5)  
  - 기존 “회원 시스템” 섹션 보강: PHP 세션 기반 인증, CSRF/세션 보안 강화 내용 검토  
- **v2.3 (Rev8.1, 2025-05-30 17:00:00)**  
  - 인증 방식을 JWT → PHP 세션 기반으로 전환  
  - “회원” 용어 통일 (기존 “고객/사용자/회원” 혼용 수정)  
  - 보안 설계 섹션 추가 (세션 하이재킹 방지, CSRF 토큰)  
- **v2.2 (Rev8, 2025-05-28 14:12:00)**  
  - 전체 기능 구조 정비 및 누락 기능(미니홈피, 알림, 다국어 등) 반영  
- **v2.1 (Rev7, 2025-05-25 11:05:00)**  
  - 초기 리뷰 반영: 용어 통일, 목차 정리  
- **v2.0 (Rev0, 2025-05-20 09:30:00)**  
  - 최초 통합본 완성

---

## 목차
1. [서비스 개요 및 목표](#서비스-개요-및-목표)  
2. [시스템/배포 환경](#시스템배포-환경)  
3. [개발 우선순위](#개발-우선순위)  
4. [히어로 섹션](#히어로-섹션)  
5. [회원 시스템](#회원-시스템)  
   - 5.1 [회원가입 / 로그인 (PHP 세션)](#51-회원가입--로그인-php-세션)  
   - 5.2 [미니홈피 (프로필)](#52-미니홈피-프로필)  
6. [회사/비전 소개 게시판](#회사비전-소개-게시판)  
7. [커뮤니티 게시판](#커뮤니티-게시판)  
8. [파트너 매칭 게시판](#파트너-매칭-게시판)  
9. [실시간 채팅](#실시간-채팅)  
10. [행사/강의 게시판](#행사강의-게시판)  
11. [알림 (Notification)](#알림-notification)  
12. [다국어 UI 및 번역](#다국어-ui-및-번역)  
13. [랭킹 및 배지 시스템](#랭킹-및-배지-시스템)  
14. [푸시 알림 정책](#푸시-알림-정책)  
15. [기타 기능](#기타-기능)  
16. [보안 설계](#보안-설계)  
17. [제약 사항 및 가정](#제약-사항-및-가정)

---

## 서비스 개요 및 목표
- **서비스명:** 탑마케팅(Top Marketing)  
- **URL/도메인:** `https://www.topmktx.com`  
- **정의:** 네트워크 마케팅 리더·기업가를 위한 글로벌 커뮤니티 플랫폼  
- **주요 목표:**  
  - 리더 개인 브랜드 강화  
  - 정보·노하우 교류 활성화  
  - 파트너십 매칭 지원  
  - 행사·강의 홍보 및 참여 유도  

---

## 시스템/배포 환경
- **도메인:** `www.topmktx.com`  
- **프로토콜:** HTTPS  
- **OS:** CentOS Linux release 7.9.2009 (Core)  
- **웹 서버:** Apache/2.4.6 (CentOS)  
- **PHP 버전:** 8.0.30  
- **데이터베이스:** MariaDB 10.6.5 (스키마: `topmkt`, CHARSET UTF8mb4)  
- **웹 루트 디렉토리:** `/var/www/html/topmkt`  
  - *주의:* 해당 폴더 이외의 프로젝트 폴더에 접근 금지  
- **SSL 인증서 파일 경로:**  
  - `SSLCertificateKeyFile /etc/pki/tls/private/KeyFile_www.topmktx.com_apache.key`  
  - `SSLCertificateFile    /etc/pki/tls/certs/File_www.topmktx.com_apache.crt`  
  - `SSLCertificateChainFile /etc/pki/tls/certs/topmktx_CA_USERTRUST_RSA_CERTIFICATION_AUTHORITY.crt`  
  - `SSLCACertificateFile   /etc/pki/tls/certs/topmktx_ChainFile_ChainBundle.crt`

---

## 개발 우선순위

### 1차 개발 (Must-have)
- **시스템 관리 및 환경 설정 (Configuration & DevOps)**  
  - 서버 설정, SSL, 도메인 바인딩, PHP-FPM/Apache 최적화  
  - `CentOS 7.9`, `Apache/2.4.6`, `PHP 8.0.30`, `MariaDB 10.6.5` 환경 구축  
  - CI/CD 파이프라인 설정 (Git → 자동 테스트 → 자동 배포)  
  - Staging/Production 분리  
- **인증/회원 관리 (Authentication & User Management)**  
  - 회원가입/로그인/로그아웃 (PHP 세션 기반, EMAIL 인증 포함)  
  - 비밀번호 재설정(OTP/이메일)  
  - 세션 보안: HttpOnly, Secure, SameSite 설정, 세션 타임아웃(30분)  
  - 권한 레벨: `ROLE_USER`, `ROLE_CORP`, `ROLE_ADMIN`  
  - 프로필(미니홈피) 기능 (WYSIWYG 에디터, 프로필 이미지 업로드)  
- **커뮤니티 게시판 / 콘텐츠 관리 (Post & Comment)**  
  - 게시글 작성/조회/수정/삭제 (Markdown + 이미지/동영상 첨부)  
  - 댓글 작성/대댓글 지원/수정/삭제  
  - 게시글 카테고리, 필터, 신고 기능  
  - 게시글/댓글 검색(간단 키워드)  
- **관리자 기능 (Admin Dashboard)**  
  - 회원 관리(조회, 권한 변경, 제재)  
  - 게시판 관리(신고된 게시글/댓글 확인 → 수정/삭제)  
  - 사이트 설정(UI 문구, 공지사항 등록)  
  - 감사 로그 조회 및 모니터링  

### 2차 개발 (Nice-to-have)
- **알림 (Notifications) & 1:1 메시지 (Messaging)**  
  - 실시간 알림: 댓글, 좋아요, 관리자 제재 통지  
  - 1:1 채팅: Firebase Realtime DB 활용, 파일 첨부, 번역 버튼  
  - 알림 설정: 이메일/브라우저 푸시/사이트 내 알림  
- **태그 (Tag) & 검색 (Search)**  
  - 게시글 태그 시스템 (태그별 게시물 필터링)  
  - 키워드 기반 고급 검색: 제목, 내용, 태그, 작성자  
  - 검색 히스토리 저장 및 추천어 제안  
- **부가 기능 (Additional Features)**  
  - 다국어 UI 및 게시글 번역 (GETTEXT, Google Translate API)  
  - 랭킹 및 배지 시스템 (활동량 기반 주간/월간 TOP 100)  
  - 푸시 알림 정책 고도화 (모바일 앱 연동 준비)  
  - 추천인 제도, 초대 링크  

*위 우선순위는 기획서, 정책서, 시스템/아키텍처 문서, API 설계서, DB 구조, 디렉토리 구조, 코딩 컨벤션, 개발 체크리스트에 모두 반영될 예정입니다.*



## 회원 시스템

### 5.1. 회원가입 / 로그인 (PHP 세션)
- **회원가입:**  
  1. 휴대폰 번호 인증 및 SMS 코드 검증  
  2. 이메일 인증 (이메일 발송 → 링크 클릭)  
  3. 비밀번호 설정 (Bcrypt 해시 저장)  
  4. 복구 이메일 선택 등록  
- **로그인:**  
  - **PHP 세션 기반**  
    1. 사용자가 로그인 폼 제출 → 서버에서 세션 생성 (`session_id`) → `Set-Cookie: PHPSESSIONID=<session_id>`  
    2. 이후 요청마다 쿠키 자동 전송 → 세션 검증 → 사용자 정보 로드  
  - **세션 보안:**  
    - 세션 쿠키 속성: `HttpOnly; Secure; SameSite=Strict`  
    - 세션 ID 재발급: 로그인 시 새로운 세션 ID 발급, 기존 ID 폐기  
    - 세션 타임아웃: 30분 미사용 시 자동 만료  
    - IP/브라우저 UA 바인딩 옵션 적용 (선택적)  
- **비밀번호 재설정:**  
  - 이메일 기반 리셋 링크 → 임시 토큰 검증 → 새 비밀번호 설정  
  - OTP(휴대폰) 인증 옵션 제공  
- **권한 레벨:**  
  - `ROLE_USER` (개인회원)  
  - `ROLE_CORP` (기업회원)  
  - `ROLE_ADMIN` (관리자)

### 5.2. 미니홈피 (프로필)
- **URL:** `/u/{nickname}`  
- **구성 요소:**  
  - 커버 이미지, 프로필 사진, 이름, 한줄 소개, 배지, 전문 분야 태그, 외부 링크  
  - WYSIWYG 에디터 + 실시간 미리보기 (Markdown 지원)  
- **이미지 정책:** JPEG/PNG/WebP (최대 10MB), 자동 리사이즈 및 메타 정보 제거  
- **프로필 편집:**  
  - 개인정보(이름, 한줄 소개, 태그) 변경  
  - 소셜 링크, 포트폴리오 URL 추가  

---

## 회사/비전 소개 게시판
- **작성 권한:** `ROLE_CORP` (기업회원)  
- **포맷:** Markdown + 이미지/동영상 첨부  
- **인터랙션:** 좋아요, 댓글, 공유  
- **기능:**  
  - 기업소개, 비전, 연혁 등 자유롭게 작성  
  - 대표자 정보, 연락처, 홈페이지 링크 제공  
  - 승인된 기업회원만 게시 가능  

---

## 커뮤니티 게시판
- **카테고리:** 자유, Q&A, 성공사례, 노하우  
- **작성 권한:** 모든 회원 (`ROLE_USER`, `ROLE_CORP`)  
- **기능:**  
  - 게시글 작성/수정/삭제 (Markdown 지원)  
  - 댓글 작성/대댓글 지원/수정/삭제  
  - 태그, 필터, 검색(게시글 제목/내용/태그)  
  - 신고, 차단 기능 (금칙어 필터 적용)  
  - 게시글 번역 버튼 (Google Translate API)  

---

## 파트너 매칭 게시판
- **기능:**  
  - 필터: 태그 · 지역 · 전문분야  
  - ‘채팅으로 제안’ 버튼 → 1:1 채팅 연결 (Firebase 기반)  
  - **알림:** 제안 수락/거절 시 푸시 알림 (Firebase Cloud Messaging)  
  - 매칭 이력 조회 → 채팅 로그 확인  

---

## 실시간 채팅
- **기술:** Firebase 또는 WebSocket  
  - 1:1 채팅, 파일 첨부(최대 10MB), 번역 버튼, 신고/차단  
  - 채팅 기록 저장 주기(1년 후 자동 삭제)  
  - 참여자 목록 표시, 읽음 상태(blue tick)  

---

## 행사/강의 게시판
- **작성 권한:** `ROLE_CORP` (기업회원)  
  - **구분:** 행사(Event) / 강의(Lecture)  
  - **기능:**  
    - 일정 등록, 참가 신청, iCal 내보내기  
    - 정원 설정, 마감 알림 설정  
    - SMS/이메일 참가기관 전송 옵션  

---

## 알림 (Notification)
- **알림 대상 이벤트:**  
  - 댓글, 좋아요, 채팅 메시지, 제안 수락/거절 등  
  - 관리자 제재(게시글/댓글 삭제) 시 알림  
  - 긴급 공지 또는 신규 공지사항 등록  
  - 비밀번호 변경, 로그인 위치 이상 징후  
- **전송 방식:**  
  - **실시간 푸시:** Firebase Cloud Messaging (FCM)  
  - **사이트 내 알림 센터:** WebSocket 또는 폴링  
  - **이메일 알림:** 중요 알림에 한함 (사용자 옵션)  
- **알림 관리:**  
  - 읽음/미확인 상태 관리, 삭제  
  - 오래된 알림 자동 보관 또는 폐기 (최대 100개 유지)  

---

## 다국어 UI 및 번역
- **지원 언어:** 한국어, 영어, 중국어, 일본어, 베트남어, 태국어  
- **UI 텍스트 관리:** Gettext 기반 PO/TM 파일 사용  
- **게시글/댓글 번역:** Google Translate API 연동, “기계 번역” 라벨 표시  
- **언어 선택:** 사용자 설정 메뉴에서 가능 (자동 감지 지원)  

---

## 랭킹 및 배지 시스템
- **랭킹 지표:** 활동량(게시글+댓글 수), 반응 수(좋아요, 댓글), 제안 수, 신고 감점  
- **주기:** 주간/월간 TOP 100  
- **배지:** 브론즈, 실버, 골드 (자동 부여 + 관리자 수동 부여)  
- **관리자 대시보드:** 랭킹 페이지 조회, 배지 수동 발급/회수 기능  

---

## 푸시 알림 정책
- **유형:** 알림함(사이트), 이메일(선택), 브라우저 푸시, 모바일 푸시 (향후 모바일 앱 연동)  
- **사용자 설정:** 전체 ON/OFF, 유형별 ON/OFF  
- **푸시 구성:**  
  - FCM 토픽 구독: “new_comment_{post_id}”, “new_message_{user_id}” 등  
  - Service Worker 설정: 푸시 수신 시 화면 알림 표시  

---

## 기타 기능
- **추천인 제도:** `/signup?ref={nickname}`  
- **초대 링크:** 로그인 전 공유 가능, URL 유효기간 설정 가능  
- **콘텐츠 저작권 가이드라인:** 사용자 업로드 이미지/동영상 권리 명시, 외부 출처 표기  
- **FAQ/고객센터:** 자주 묻는 질문 메뉴 제공, 문의 게시판 운영  

---

## 보안 설계
- **세션 하이재킹 방지:** IP/UA 바인딩, 세션 재발급 주기(로그인 시 재발급)  
- **CSRF 방어:** 모든 상태 변경 요청(Form+AJAX)에 CSRF 토큰 검증  
- **XSS 방지:** 입력값 필터링 + 출력 시 `htmlspecialchars` 적용, DOMPurify 등 HTML Sanitizer 사용  
- **SQL 인젝션 방지:** Prepared Statement 사용, ORM/쿼리 빌더 활용  
- **파일 업로드 검사:** 확장자/크기/악성코드 검사, 저장 시 파일명 난수화  
- **로그 기록:** 감사 로그(Audit Log) 및 이상 징후 모니터링 시스템 구축  

---

## 제약 사항 및 가정
- 초기 국가는 **한국**, 향후 글로벌 확대 계획  
- **Firebase 비용** 고려 → 자체 서버 전환 가능성 있음  
- **게시글 번역**은 요청 시 동적 API 호출 (비용 · 속도 고려)  
- **모바일 앱**은 2차 개발 이후 검토 예정 (React Native / Flutter 등)  
- **Stack Overflow 및 오픈 소스 라이브러리** 사용 시 라이선스 검토 필수  

---

※ 본 기획서는 1차/2차 우선순위 및 시스템 환경 설정을 중심으로 작성되었습니다. 각 기능별 상세 요구사항는 API 설계서, DB 구조, 시스템 아키텍처 문서에서 확인하시기 바랍니다.
