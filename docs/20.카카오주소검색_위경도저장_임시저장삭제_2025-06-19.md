# ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ API êµ¬í˜„ & ìœ„ê²½ë„ ì €ì¥ & ì„ì‹œì €ì¥ ì‚­ì œ ê¸°ëŠ¥ ê°œë°œ

**ì‘ì—…ì¼:** 2025-06-19  
**ê°œë°œì:** Claude Code Assistant  
**ì‘ì—… ë¶„ë¥˜:** ê°•ì˜ ë“±ë¡ ì‹œìŠ¤í…œ ê³ ë„í™”

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ê°•ì˜ ë“±ë¡ ì‹œìŠ¤í…œì— ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ APIë¥¼ ë„ì…í•˜ì—¬ ì •í™•í•œ ì£¼ì†Œ ì…ë ¥ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³ , ìœ„ë„/ê²½ë„ ì¢Œí‘œ ì €ì¥ ê¸°ëŠ¥ ë° ì„ì‹œì €ì¥ ê°•ì˜ ìë™ ì‚­ì œ ê¸°ëŠ¥ì„ ê°œë°œí–ˆìŠµë‹ˆë‹¤.

### ğŸ¯ ì£¼ìš” ëª©í‘œ
1. **ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ API êµ¬í˜„**: ì •í™•í•œ ì£¼ì†Œ ì…ë ¥ì„ ìœ„í•œ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ ì—°ë™
2. **ìœ„ë„/ê²½ë„ ì €ì¥ ê¸°ëŠ¥**: ê°•ì˜ ì¥ì†Œì˜ ì¢Œí‘œ ì •ë³´ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
3. **ì„ì‹œì €ì¥ ìë™ ì‚­ì œ**: ê°•ì˜ ë°œí–‰ ì‹œ ê¸°ì¡´ ì„ì‹œì €ì¥ ê°•ì˜ ì •ë¦¬
4. **UTF-8 ì¸ì½”ë”© ë¬¸ì œ í•´ê²°**: MySQL í•œê¸€ ì €ì¥ ë¬¸ì œ ì™„ì „ í•´ê²°

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ API êµ¬í˜„
**íŒŒì¼:** `/workspace/src/views/lectures/create.php`

```javascript
// ì¹´ì¹´ì˜¤ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ êµ¬í˜„
function initAddressSearch() {
    const addressSearchBtn = document.getElementById('address_search_btn');
    const addressField = document.getElementById('venue_address');

    addressSearchBtn.addEventListener('click', function() {
        new daum.Postcode({
            oncomplete: function(data) {
                let addr = data.address; // ìµœì¢… ì£¼ì†Œ ë³€ìˆ˜
                let extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜

                // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }

                // ë„ë¡œëª… ì£¼ì†Œì¼ ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
                if(data.userSelectedType === 'R'){
                    if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                }

                // ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                addressField.value = addr + extraAddr;
                
                // ì¢Œí‘œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹œë„
                getCoordinates(addr);
            }
        }).open();
    });
}
```

**êµ¬í˜„ íŠ¹ì§•:**
- âœ… **API Key ë¶ˆí•„ìš”**: ì¹´ì¹´ì˜¤ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ëŠ” ë¬´ë£Œ ì‚¬ìš© ê°€ëŠ¥
- âœ… **ë„ë¡œëª…/ì§€ë²ˆ ì£¼ì†Œ ì§€ì›**: ì‚¬ìš©ì ì„ íƒì— ë”°ë¥¸ ìœ ì—°í•œ ì£¼ì†Œ ì…ë ¥
- âœ… **ì°¸ê³ í•­ëª© ìë™ ì¡°í•©**: ê±´ë¬¼ëª…, ë™ ì •ë³´ ìë™ ì¶”ê°€
- âœ… **ì‹¤ì‹œê°„ ê²€ìƒ‰**: íŒì—… í˜•íƒœì˜ ì§ê´€ì ì¸ ì£¼ì†Œ ê²€ìƒ‰

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥
**ì‘ì—…:** MySQL í…Œì´ë¸”ì— ìœ„ë„/ê²½ë„ í•„ë“œ ì¶”ê°€

```sql
-- lectures í…Œì´ë¸”ì— ì¢Œí‘œ í•„ë“œ ì¶”ê°€
ALTER TABLE lectures ADD COLUMN venue_latitude DECIMAL(10,8) NULL AFTER venue_address;
ALTER TABLE lectures ADD COLUMN venue_longitude DECIMAL(11,8) NULL AFTER venue_latitude;
```

**ë°ì´í„°ë² ì´ìŠ¤ ê²€ì¦:**
```sql
mysql> DESCRIBE lectures;
+------------------+--------------------------------------------------+------+-----+-----------------+----------------+
| Field            | Type                                             | Null | Key | Default         | Extra          |
+------------------+--------------------------------------------------+------+-----+-----------------+----------------+
| venue_latitude   | decimal(10,8)                                    | YES  |     | NULL            |                |
| venue_longitude  | decimal(11,8)                                    | YES  |     | NULL            |                |
+------------------+--------------------------------------------------+------+-----+-----------------+----------------+
```

### 3. LectureController ë°±ì—”ë“œ ë¡œì§ êµ¬í˜„
**íŒŒì¼:** `/workspace/src/controllers/LectureController.php`

#### createLecture ë©”ì„œë“œ ì—…ë°ì´íŠ¸
```php
$params = [
    // ... ê¸°ì¡´ íŒŒë¼ë¯¸í„°ë“¤ ...
    ':venue_latitude' => !empty($data['venue_latitude']) ? floatval($data['venue_latitude']) : null,
    ':venue_longitude' => !empty($data['venue_longitude']) ? floatval($data['venue_longitude']) : null,
    // ... ë‚˜ë¨¸ì§€ íŒŒë¼ë¯¸í„°ë“¤ ...
];
```

#### updateLecture ë©”ì„œë“œ ì—…ë°ì´íŠ¸
```sql
UPDATE lectures SET 
    -- ... ê¸°ì¡´ í•„ë“œë“¤ ...
    venue_latitude = :venue_latitude,
    venue_longitude = :venue_longitude,
    -- ... ë‚˜ë¨¸ì§€ í•„ë“œë“¤ ...
WHERE id = :lecture_id
```

#### ì„ì‹œì €ì¥ ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„
```php
/**
 * ì‚¬ìš©ìì˜ ì„ì‹œì €ì¥(draft) ê°•ì˜ë“¤ì„ ì‚­ì œ
 */
private function deleteDraftLectures($userId, $excludeId = null) {
    try {
        $sql = "DELETE FROM lectures WHERE user_id = :user_id AND status = 'draft'";
        $params = [':user_id' => $userId];
        
        // í˜„ì¬ ìƒì„±ëœ ê°•ì˜ëŠ” ì œì™¸
        if ($excludeId) {
            $sql .= " AND id != :exclude_id";
            $params[':exclude_id'] = $excludeId;
        }
        
        $result = $this->db->execute($sql, $params);
        
        if ($result) {
            error_log("ì‚¬ìš©ì {$userId}ì˜ ì„ì‹œì €ì¥ ê°•ì˜ë“¤ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ì œì™¸: {$excludeId})");
        }
        
        return $result;
        
    } catch (Exception $e) {
        error_log("ì„ì‹œì €ì¥ ê°•ì˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: " . $e->getMessage());
        return false;
    }
}
```

### 4. MySQL UTF-8 ì¸ì½”ë”© ë¬¸ì œ í•´ê²°
**íŒŒì¼:** `/etc/mysql/mariadb.conf.d/50-utf8.cnf`

```ini
# UTF-8 Character Set Configuration
# This ensures all connections use UTF-8 by default

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
```

**ê²€ì¦ ê²°ê³¼:**
```sql
mysql> SHOW VARIABLES LIKE 'character%';
+----------------------+----------+
| Variable_name        | Value    |
+----------------------+----------+
| character_set_client | utf8mb4  |
| character_set_connection | utf8mb4  |
| character_set_database | utf8mb4  |
| character_set_results | utf8mb4  |
| character_set_server | utf8mb4  |
+----------------------+----------+
```

---

## ğŸ”§ ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. ì¢Œí‘œ ë³€í™˜ ë¡œì§ (í–¥í›„ êµ¬í˜„)
í˜„ì¬ëŠ” ì¹´ì¹´ì˜¤ ë¡œì»¬ API Key ë¶€ì¬ë¡œ ì¢Œí‘œ ë³€í™˜ì„ ë¹„í™œì„±í™”í–ˆìœ¼ë‚˜, í–¥í›„ êµ¬í˜„ì„ ìœ„í•œ êµ¬ì¡°ëŠ” ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```javascript
// ì¢Œí‘œ ì •ë³´ëŠ” ë‚˜ì¤‘ì— êµ¬í˜„ (í˜„ì¬ëŠ” ì£¼ì†Œë§Œ ì €ì¥)
function getCoordinates(address) {
    console.log('ì£¼ì†Œ ì €ì¥ë¨:', address);
    console.log('ì¢Œí‘œ ê¸°ëŠ¥ì€ API í‚¤ ì„¤ì • í›„ í™œì„±í™” ì˜ˆì •');
    
    // ì¢Œí‘œ í•„ë“œëŠ” ë¹„ì›Œë‘  (ë‚˜ì¤‘ì— ê´€ë¦¬ìê°€ ë³„ë„ë¡œ ì…ë ¥í•˜ê±°ë‚˜ API í‚¤ ì„¤ì • í›„ ìë™ ì²˜ë¦¬)
    document.getElementById('venue_latitude').value = '';
    document.getElementById('venue_longitude').value = '';
    
    // ì£¼ì†Œ ì…ë ¥ ì™„ë£Œë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ
    const addressField = document.getElementById('venue_address');
    addressField.style.backgroundColor = '#f0f9ff';
    addressField.style.borderColor = '#0ea5e9';
}
```

### 2. ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
```php
// ë¹ˆ ê°’ ì²˜ë¦¬ë¥¼ í†µí•œ ì•ˆì „í•œ ë°ì´í„° ì €ì¥
':venue_latitude' => !empty($data['venue_latitude']) ? floatval($data['venue_latitude']) : null,
':venue_longitude' => !empty($data['venue_longitude']) ? floatval($data['venue_longitude']) : null,
```

### 3. ì„ì‹œì €ì¥ ë¡œì§ í†µí•©
- **ìƒì„± ì‹œ**: ìƒˆ ê°•ì˜ê°€ 'published' ìƒíƒœë¡œ ìƒì„±ë˜ë©´ ê¸°ì¡´ draft ì‚­ì œ
- **ìˆ˜ì • ì‹œ**: draftì—ì„œ 'published'ë¡œ ìƒíƒœ ë³€ê²½ ì‹œ ë‹¤ë¥¸ draft ì‚­ì œ
- **ì œì™¸ ì²˜ë¦¬**: í˜„ì¬ ì‘ì—… ì¤‘ì¸ ê°•ì˜ëŠ” ì‚­ì œ ëŒ€ìƒì—ì„œ ì œì™¸

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### 1. ê°•ì˜ ë“±ë¡ í…ŒìŠ¤íŠ¸
- **í…ŒìŠ¤íŠ¸ ê°•ì˜ ID**: 130
- **ì£¼ì†Œ ì…ë ¥**: "ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300 (ì‹ ì²œë™)" âœ…
- **ìƒíƒœ**: published âœ…
- **ë“±ë¡ ì‹œê°„**: 2025-06-19 00:12:43 âœ…

```sql
mysql> SELECT id, title, venue_address, venue_latitude, venue_longitude, status, created_at FROM lectures WHERE id = 130;
+-----+----------+---------------------------------+----------------+-----------------+-----------+---------------------+
| id  | title    | venue_address                   | venue_latitude | venue_longitude | status    | created_at          |
+-----+----------+---------------------------------+----------------+-----------------+-----------+---------------------+
| 130 | asdsadsa | ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300 (ì‹ ì²œë™) | NULL           | NULL            | published | 2025-06-19 00:12:43 |
+-----+----------+---------------------------------+----------------+-----------------+-----------+---------------------+
```

### 2. UTF-8 ì¸ì½”ë”© í…ŒìŠ¤íŠ¸
- **ì´ì „**: `??  ??? ????  300 (??)` (ê¹¨ì§„ ë¬¸ì)
- **ìˆ˜ì • í›„**: `ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300 (ì‹ ì²œë™)` âœ…

---

## ğŸš« í™•ì¸ëœ ë¬¸ì œì 

### 1. ê°•ì‚¬ ì´ë¯¸ì§€ ëˆ„ë½ ë¬¸ì œ
**ë¬¸ì œ:** instructors_jsonì— ì´ë¯¸ì§€ ì •ë³´ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ
```json
// í˜„ì¬ ìƒíƒœ (ì´ë¯¸ì§€ í•„ë“œ ëˆ„ë½)
[{"name":"asdasdsa","info":"sadasdasdasd","title":"dsadsadsadsa"},{"name":"asdsadsadsa","info":"asdaasddasdsdsadasdsa","title":"dassadsadsa"}]

// ê¸°ëŒ€ ìƒíƒœ (ì´ë¯¸ì§€ í•„ë“œ í¬í•¨)
[{"name":"asdasdsa","info":"sadasdasdasd","title":"dsadsadsadsa","image":"/assets/uploads/instructors/instructor_0_xxx.webp"}]
```

**ë¶„ì„:** ê°•ì‚¬ ì´ë¯¸ì§€ ì—…ë¡œë“œëŠ” ì •ìƒ ì‘ë™í•˜ë‚˜ JSON ë°ì´í„° ì €ì¥ ì‹œ ì´ë¯¸ì§€ ê²½ë¡œê°€ ëˆ„ë½ë¨

### 2. ì¹´ì¹´ì˜¤ ë¡œì»¬ API 401 ì˜¤ë¥˜
**ë¬¸ì œ:** ì¢Œí‘œ ë³€í™˜ ì‹œ "401 Unauthorized" ì˜¤ë¥˜
**í•´ê²°:** í˜„ì¬ëŠ” ì£¼ì†Œë§Œ ì €ì¥í•˜ê³ , í–¥í›„ ìœ íš¨í•œ API Key ë°œê¸‰ í›„ ì¢Œí‘œ ê¸°ëŠ¥ í™œì„±í™” ì˜ˆì •

---

## ğŸ“ˆ ì„±ê³¼ ë° ê°œì„ ì‚¬í•­

### âœ… ì„±ê³µí•œ ë¶€ë¶„
1. **ì¹´ì¹´ì˜¤ ìš°í¸ë²ˆí˜¸ API**: ì™„ë²½í•˜ê²Œ ì‘ë™í•˜ì—¬ ì •í™•í•œ ì£¼ì†Œ ì…ë ¥ ê°€ëŠ¥
2. **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: venue_latitude, venue_longitude í•„ë“œ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€
3. **UTF-8 ë¬¸ì œ í•´ê²°**: MySQL ì „ì—­ ì„¤ì •ìœ¼ë¡œ í•œê¸€ ì €ì¥ ë¬¸ì œ ì™„ì „ í•´ê²°
4. **ì„ì‹œì €ì¥ ì‚­ì œ**: published ìƒíƒœ ê°•ì˜ ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ draft ì •ë¦¬
5. **ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬**: ë¹ˆ ê°’ ê²€ì¦ì„ í†µí•œ NULL ì²˜ë¦¬

### ğŸ”„ ê°œì„  í•„ìš” ì‚¬í•­
1. **ê°•ì‚¬ ì´ë¯¸ì§€ ì €ì¥ ë¡œì§**: handleInstructorImageUploads í•¨ìˆ˜ ë””ë²„ê¹… í•„ìš”
2. **ì¹´ì¹´ì˜¤ ë¡œì»¬ API Key**: ì¢Œí‘œ ìë™ ë³€í™˜ ê¸°ëŠ¥ì„ ìœ„í•œ API Key ë°œê¸‰
3. **ì§€ë„ ì—°ë™**: ì €ì¥ëœ ì¢Œí‘œë¥¼ í™œìš©í•œ ë„¤ì´ë²„ ì§€ë„ ë§ˆì»¤ í‘œì‹œ

---

## ğŸ”® í–¥í›„ ê³„íš

### 1. ê°•ì‚¬ ì´ë¯¸ì§€ ë¬¸ì œ í•´ê²° (ìš°ì„ ìˆœìœ„: ë†’ìŒ)
- handleInstructorImageUploads í•¨ìˆ˜ ë¡œê·¸ ë¶„ì„
- POST ë°ì´í„°ì™€ JSON ì €ì¥ ê³¼ì • ë””ë²„ê¹…
- ì´ë¯¸ì§€ ê²½ë¡œ ë§¤í•‘ ë¡œì§ ì ê²€

### 2. ì¢Œí‘œ ê¸°ëŠ¥ ì™„ì„± (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)
- ì¹´ì¹´ì˜¤ ë¡œì»¬ API Key ë°œê¸‰
- ìë™ ì¢Œí‘œ ë³€í™˜ ê¸°ëŠ¥ í™œì„±í™”
- ë„¤ì´ë²„ ì§€ë„ì™€ ì¢Œí‘œ ì—°ë™

### 3. ì‚¬ìš©ì ê²½í—˜ ê°œì„  (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
- ì£¼ì†Œ ê²€ìƒ‰ í›„ ì¢Œí‘œ ë¡œë”© ìƒíƒœ í‘œì‹œ
- ì§€ë„ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
- ì£¼ì†Œ ìˆ˜ì • ì‹œ ì¢Œí‘œ ìë™ ì—…ë°ì´íŠ¸

---

## ğŸ“š ê´€ë ¨ ê°•ì˜ ì„¹ì…˜ ë¶„ì„

### getRelatedLectures ë©”ì„œë“œ ë™ì‘ ì›ë¦¬
**ìœ„ì¹˜:** `/workspace/src/controllers/LectureController.php:806-822`

```php
private function getRelatedLectures($category, $excludeId, $limit = 3) {
    return $this->db->fetchAll("
        SELECT l.*, u.nickname as organizer_name
        FROM lectures l
        JOIN users u ON l.user_id = u.id
        WHERE l.status = 'published'
        AND l.category = :category
        AND l.id != :exclude_id
        AND l.start_date >= CURDATE()
        ORDER BY l.start_date ASC
        LIMIT :limit
    ", [
        ':category' => $category,
        ':exclude_id' => $excludeId,
        ':limit' => $limit
    ]);
}
```

**í‘œì‹œ ì¡°ê±´:**
1. **ê°™ì€ ì¹´í…Œê³ ë¦¬**: í˜„ì¬ ê°•ì˜ì™€ ë™ì¼í•œ category ê°’
2. **ë°œí–‰ ìƒíƒœ**: status = 'published'
3. **í˜„ì¬ ê°•ì˜ ì œì™¸**: ë³´ê³  ìˆëŠ” ê°•ì˜ëŠ” ì œì™¸
4. **ë¯¸ë˜ ì¼ì •**: start_date >= ì˜¤ëŠ˜ ë‚ ì§œ
5. **ì •ë ¬**: ì‹œì‘ì¼ ì˜¤ë¦„ì°¨ìˆœ
6. **ê°œìˆ˜ ì œí•œ**: ìµœëŒ€ 3ê°œ

---

## ğŸ”— ì—°ê´€ íŒŒì¼ ë° ì»¤ë°‹ ì •ë³´

### ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡
1. `/workspace/src/views/lectures/create.php` - ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ UI êµ¬í˜„
2. `/workspace/src/controllers/LectureController.php` - ë°±ì—”ë“œ ë¡œì§ êµ¬í˜„
3. `/workspace/src/config/database.php` - UTF-8 ì„¤ì • ê°•í™”
4. `/etc/mysql/mariadb.conf.d/50-utf8.cnf` - MySQL ì „ì—­ UTF-8 ì„¤ì •

### ì‹¤í–‰ëœ SQL ëª…ë ¹ì–´
```sql
ALTER TABLE lectures ADD COLUMN venue_latitude DECIMAL(10,8) NULL AFTER venue_address;
ALTER TABLE lectures ADD COLUMN venue_longitude DECIMAL(11,8) NULL AFTER venue_latitude;
```

---

**ğŸ“ ì‘ì„±ì:** Claude Code Assistant  
**ğŸ“§ ë¬¸ì˜:** dev@topmktx.com  
**ğŸ”„ ë‹¤ìŒ ì‘ì—…:** ê°•ì‚¬ ì´ë¯¸ì§€ ì €ì¥ ë¬¸ì œ í•´ê²°