import{u as t}from"./react-vendor-Bzu6yK0-.js";import{a as e}from"./http-vendor-BP9N28r3.js";const a={}.REACT_APP_API_URL||"";let s="";const o=e.create({baseURL:a,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0});o.interceptors.request.use(async t=>{const o=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");if(o&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${o}`),["post","put","patch","delete"].includes(t.method?.toLowerCase()||""))try{const o=await(async()=>{if(s)return s;try{const t=await e.get(`${a}/csrf-token`);return s=t.data.csrf_token||"",s}catch(t){return""}})();o&&(t.headers=t.headers||{},t.headers["X-CSRF-TOKEN"]=o)}catch(r){}return t},t=>Promise.reject(t)),o.interceptors.response.use(t=>t,async t=>{const s=t.config;if(401===t.response?.status&&!s._retry){s._retry=!0;try{const t=await e.post(`${a}/auth/refresh`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token")}`},withCredentials:!0});if(t.data.success&&t.data.data.token){const e=t.data.data.token;return(localStorage.getItem("auth_token")?localStorage:sessionStorage).setItem("auth_token",e),s.headers&&(s.headers.Authorization=`Bearer ${e}`),o(s)}}catch(r){return localStorage.removeItem("auth_token"),sessionStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),sessionStorage.removeItem("user_data"),window.location.href="/auth/login",Promise.reject(r)}}return t.response,t.response,t.response,t.response,t.response,Promise.reject(t)});const r=async(t,e,a=3)=>{for(let r=0;r<a;r++)try{return await o.get(t,e)}catch(s){if(r===a-1)throw s;await new Promise(t=>setTimeout(t,1e3*Math.pow(2,r)))}throw new Error("최대 재시도 횟수 초과")},n=async(t,e,a)=>o.post(t,e,a),i=async(t,e,a)=>o.put(t,e,a),c=async(t,e)=>o.delete(t,e);const m=new class{async getPosts(t={}){const e=new URLSearchParams;t.search&&e.append("search",t.search),t.filter&&"all"!==t.filter&&e.append("filter",t.filter),t.page&&e.append("page",t.page.toString()),t.limit&&e.append("limit",t.limit.toString());const a=e.toString(),s="/api/community/posts"+(a?`?${a}`:"");return(await r(s)).data}async getPost(t){return(await r(`/api/community/posts/${t}`)).data}async createPost(t){return(await n("/api/community/posts",t)).data}async updatePost(t,e){return(await i(`/api/community/posts/${t}`,e)).data}async deletePost(t){return(await c(`/api/community/posts/${t}`)).data}async likePost(t){return(await n(`/api/community/posts/${t}/like`)).data}async unlikePost(t){return(await c(`/api/community/posts/${t}/like`)).data}async getComments(t){return(await r(`/api/community/posts/${t}/comments`)).data}async createComment(t,e){return(await n(`/api/community/posts/${t}/comments`,e)).data}async updateComment(t,e,a){return(await i(`/api/community/posts/${t}/comments/${e}`,a)).data}async deleteComment(t,e){return(await c(`/api/community/posts/${t}/comments/${e}`)).data}async likeComment(t,e){return(await n(`/api/community/posts/${t}/comments/${e}/like`)).data}async unlikeComment(t,e){return(await c(`/api/community/posts/${t}/comments/${e}/like`)).data}async getCategories(){return(await r("/api/community/categories")).data}},p={all:["community"],posts:()=>[...p.all,"posts"],post:t=>[...p.all,"post",t],postsList:t=>[...p.posts(),"list",t],comments:t=>[...p.all,"comments",t],categories:()=>[...p.all,"categories"]},u=(e={})=>t({queryKey:p.postsList(e),queryFn:async({pageParam:t=1})=>{const a=await m.getPosts({...e,page:t,limit:20});if(!a.success||!a.data)throw new Error(a.message||"게시글을 불러오는데 실패했습니다.");return{posts:a.data.posts||[],pagination:a.data.pagination||{current_page:t,total_pages:1,total_count:0,has_next:!1,has_prev:t>1}}},getNextPageParam:t=>{const{pagination:e}=t;return e.has_next?e.current_page+1:void 0},getPreviousPageParam:t=>{const{pagination:e}=t;return e.has_prev?e.current_page-1:void 0},initialPageParam:1,staleTime:e.search?0:3e5,gcTime:6e5});export{m as C,o as a,u};
