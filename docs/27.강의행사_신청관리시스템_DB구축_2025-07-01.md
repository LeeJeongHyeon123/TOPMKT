# ê°•ì˜/í–‰ì‚¬ ì‹ ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ DB êµ¬ì¶•

**ì‘ì—…ì¼**: 2025-07-01  
**ì‘ì—…ì**: Claude  
**ì‘ì—… ìœ í˜•**: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ë° êµ¬ì¶•  

## ğŸ“‹ ì‘ì—… ê°œìš”

ê°•ì˜ì™€ í–‰ì‚¬ì— ëŒ€í•œ ì°¸ê°€ ì‹ ì²­ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ `lecture_registrations` í…Œì´ë¸”ì„ í™•ì¥í•˜ì—¬ ì™„ì „í•œ ì‹ ì²­ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ƒï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë³€ê²½ì‚¬í•­

### 1. `lectures` í…Œì´ë¸” í™•ì¥

ê¸°ì¡´ ê°•ì˜ í…Œì´ë¸”ì— ì°¸ê°€ì ê´€ë¦¬ í•„ë“œ ì¶”ê°€:

```sql
ALTER TABLE lectures ADD COLUMN:
- max_participants INT NULL COMMENT 'ìµœëŒ€ ì°¸ê°€ì ìˆ˜ (NULLì´ë©´ ë¬´ì œí•œ)'
- current_participants INT DEFAULT 0 COMMENT 'í˜„ì¬ ì°¸ê°€ì ìˆ˜'  
- auto_approval BOOLEAN DEFAULT FALSE COMMENT 'ìë™ ìŠ¹ì¸ ì—¬ë¶€'
- registration_start_date DATETIME NULL COMMENT 'ì‹ ì²­ ì‹œì‘ì¼ì‹œ'
- registration_end_date DATETIME NULL COMMENT 'ì‹ ì²­ ë§ˆê°ì¼ì‹œ'
- allow_waiting_list BOOLEAN DEFAULT FALSE COMMENT 'ëŒ€ê¸°ì ëª…ë‹¨ í—ˆìš© ì—¬ë¶€'
```

### 2. `lecture_registrations` í…Œì´ë¸” í™•ì¥

ê¸°ì¡´ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ ê´€ë¦¬ ê¸°ëŠ¥ ê°•í™”:

**ê¸°ì¡´ í•„ë“œ (ìœ ì§€)**:
- `participant_name`, `participant_email`, `participant_phone`
- `company_name`, `position`, `special_requests`
- `payment_status`, `payment_amount`, `payment_date`

**ìƒˆë¡œ ì¶”ê°€ëœ í•„ë“œ**:
```sql
- processed_by INT(11) NULL COMMENT 'ì²˜ë¦¬í•œ ê´€ë¦¬ì/ê¸°ì—… ì‚¬ìš©ì ID'
- processed_at TIMESTAMP NULL COMMENT 'ì²˜ë¦¬ ì¼ì‹œ'
- admin_notes TEXT NULL COMMENT 'ê´€ë¦¬ì ë©”ëª¨/ê±°ì ˆ ì‚¬ìœ '
- attendance_checked_at TIMESTAMP NULL COMMENT 'ì¶œì„ ì²´í¬ ì‹œê°„'
- attendance_checked_by INT(11) NULL COMMENT 'ì¶œì„ ì²´í¬í•œ ì‚¬ìš©ì ID'
- motivation TEXT NULL COMMENT 'ì°¸ê°€ ë™ê¸°/ëª©ì '
- how_did_you_know VARCHAR(255) NULL COMMENT 'ì–´ë–»ê²Œ ì•Œê²Œ ë˜ì—ˆëŠ”ì§€'
- is_waiting_list BOOLEAN DEFAULT FALSE COMMENT 'ëŒ€ê¸°ì ëª…ë‹¨ ì—¬ë¶€'
- waiting_order INT NULL COMMENT 'ëŒ€ê¸° ìˆœë²ˆ'
```

**ìƒíƒœ í™•ì¥**:
```sql
status ENUM('pending', 'approved', 'rejected', 'cancelled', 'attended', 'no_show', 'waiting')
```

### 3. ìƒˆë¡œ ìƒì„±ëœ í…Œì´ë¸”ë“¤

#### `registration_history` - ì‹ ì²­ ì²˜ë¦¬ ì´ë ¥
```sql
- registration_id INT(11) NOT NULL
- action_type ENUM('apply', 'approve', 'reject', 'cancel', 'attend', 'no_show', ...)
- old_status VARCHAR(50) NULL
- new_status VARCHAR(50) NULL  
- notes TEXT NULL
- performed_by INT(11) NOT NULL
- performed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
```

#### `notification_settings` - ì•Œë¦¼ ì„¤ì •
```sql
- user_id INT(11) NOT NULL
- lecture_id INT(11) NULL (NULLì´ë©´ ì „ì²´ ì„¤ì •)
- email_new_registration BOOLEAN DEFAULT TRUE
- email_registration_approved BOOLEAN DEFAULT TRUE
- email_registration_rejected BOOLEAN DEFAULT TRUE
- email_lecture_reminder BOOLEAN DEFAULT TRUE
- system_new_registration BOOLEAN DEFAULT TRUE
- system_capacity_warning BOOLEAN DEFAULT TRUE
```

### 4. ë·°(Views) ìƒì„±

#### `registration_statistics` - í†µê³„ ë·°
ì‹¤ì‹œê°„ ì‹ ì²­ í˜„í™© ë° ì •ì› ë¹„ìœ¨ ê³„ì‚°:
```sql
- lecture_id, lecture_title, content_type
- max_participants, current_participants
- total_applications, pending_count, approved_count
- rejected_count, cancelled_count, attended_count
- capacity_percentage (ì •ì› ëŒ€ë¹„ ìŠ¹ì¸ ë¹„ìœ¨)
```

#### `registration_api_view` - API í˜¸í™˜ ë·°
ê¸°ì¡´ í…Œì´ë¸” êµ¬ì¡°ì™€ ìƒˆ API ì„¤ê³„ ê°„ ë§¤í•‘:
```sql
- participant_name â†’ applicant_name ë§¤í•‘
- participant_email â†’ applicant_email ë§¤í•‘
- position â†’ applicant_position ë§¤í•‘
```

## âš™ï¸ ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶•

### 1. íŠ¸ë¦¬ê±° ì‹œìŠ¤í…œ

#### `update_participant_count_after_registration`
- ì‹ ì²­ ìƒíƒœ ë³€ê²½ì‹œ `current_participants` ìë™ ì—…ë°ì´íŠ¸
- `registration_history`ì— ë³€ê²½ ì´ë ¥ ìë™ ê¸°ë¡

#### `update_participant_count_after_insert`  
- ì‹ ê·œ ì‹ ì²­ì‹œ ì´ë ¥ ê¸°ë¡
- ìë™ ìŠ¹ì¸ ì„¤ì •ëœ ê°•ì˜ì˜ ê²½ìš° ì¦‰ì‹œ ìŠ¹ì¸ ì²˜ë¦¬
- ì°¸ê°€ì ìˆ˜ ìë™ ê³„ì‚°

### 2. ì¸ë±ìŠ¤ ìµœì í™”

ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•œ ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€:
```sql
- idx_processed (processed_by, processed_at)
- idx_waiting_list (lecture_id, is_waiting_list, waiting_order)  
- idx_status_date (status, registration_date)
```

## ğŸ”§ êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥

### 1. ì‹ ì²­ ê´€ë¦¬ ê¸°ëŠ¥
- âœ… **ìë™/ìˆ˜ë™ ìŠ¹ì¸ ì‹œìŠ¤í…œ**: `auto_approval` í•„ë“œë¡œ ì œì–´
- âœ… **ì •ì› ê´€ë¦¬**: `max_participants`ì™€ `current_participants`ë¡œ ì‹¤ì‹œê°„ ê´€ë¦¬
- âœ… **ëŒ€ê¸°ì ëª…ë‹¨**: ì •ì› ì´ˆê³¼ì‹œ `waiting_order`ë¡œ ìˆœë²ˆ ê´€ë¦¬
- âœ… **ì‹ ì²­ ê¸°ê°„ ì œí•œ**: `registration_start_date`, `registration_end_date`

### 2. ì¶œì„ ê´€ë¦¬ ê¸°ëŠ¥
- âœ… **ì¶œì„ ì²´í¬**: `attendance_checked_at`, `attendance_checked_by`
- âœ… **ë…¸ì‡¼ ê´€ë¦¬**: `no_show` ìƒíƒœë¡œ ë¬´ë‹¨ ë¶ˆì°¸ ê´€ë¦¬
- âœ… **ì°¸ì„ í™•ì¸**: `attended` ìƒíƒœë¡œ ì‹¤ì œ ì°¸ì„ ê¸°ë¡

### 3. ì•Œë¦¼ ì‹œìŠ¤í…œ ê¸°ë°˜
- âœ… **ê°œë³„ ì„¤ì •**: ì‚¬ìš©ìë³„, ê°•ì˜ë³„ ì„¸ë¶„í™”ëœ ì•Œë¦¼ ì„¤ì •
- âœ… **ì´ë©”ì¼ ì•Œë¦¼**: ì‹ ì²­/ìŠ¹ì¸/ê±°ì ˆ/ë¦¬ë§ˆì¸ë” ë“±
- âœ… **ì‹œìŠ¤í…œ ì•Œë¦¼**: ëŒ€ì‹œë³´ë“œ ë‚´ ì‹¤ì‹œê°„ ì•Œë¦¼

### 4. ë°ì´í„° ë¶„ì„ ê¸°ëŠ¥
- âœ… **ì‹¤ì‹œê°„ í†µê³„**: `registration_statistics` ë·°ë¡œ ì¦‰ì‹œ ì¡°íšŒ
- âœ… **ì´ë ¥ ì¶”ì **: ëª¨ë“  ìƒíƒœ ë³€ê²½ ì´ë ¥ ì™„ì „ ê¸°ë¡
- âœ… **ì •ì› ë¹„ìœ¨**: ì‹¤ì‹œê°„ ìˆ˜ìš©ë¥  ê³„ì‚°

## ğŸ“Š ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„±

### 1. ê²°ì œ ì‹œìŠ¤í…œ ì™„ì „ í˜¸í™˜
- ê¸°ì¡´ `payment_status`, `payment_amount`, `payment_date` í•„ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€
- ê²°ì œ ì™„ë£Œ í›„ ìŠ¹ì¸ ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš° ì§€ì›

### 2. ì‚¬ìš©ì ê¶Œí•œ ì‹œìŠ¤í…œ ì—°ë™
- `users.role` (ROLE_USER, ROLE_CORP, ROLE_ADMIN) í™œìš©
- `company_profiles` í…Œì´ë¸”ê³¼ ì—°ë™í•˜ì—¬ ê¸°ì—… ì •ë³´ ìë™ ë§¤í•‘

### 3. ê¸°ì¡´ API êµ¬ì¡° ë³´ì¡´
- `registration_api_view`ë¥¼ í†µí•´ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ì§€ì›

## ğŸš€ ë‹¤ìŒ êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ ê¸°ëŠ¥ (2ì£¼)
1. **ì‚¬ìš©ì ì‹ ì²­ í¼ UI** - ê°•ì˜/í–‰ì‚¬ ì‹ ì²­ ì¸í„°í˜ì´ìŠ¤
2. **ê¸°ë³¸ CRUD API** - ì‹ ì²­, ì¡°íšŒ, ìˆ˜ì •, ì·¨ì†Œ
3. **ê°„ë‹¨í•œ ê´€ë¦¬ í˜ì´ì§€** - ê¸°ì—…ìš© ì‹ ì²­ ëª©ë¡ ì¡°íšŒ

### Phase 2: ê³ ê¸‰ ê´€ë¦¬ (2ì£¼)  
1. **ê¸°ì—… ëŒ€ì‹œë³´ë“œ** - ì‹ ì²­ì ê´€ë¦¬ ë° ìŠ¹ì¸/ê±°ì ˆ ì²˜ë¦¬
2. **í†µê³„ ë° ë¦¬í¬íŠ¸** - ì‹¤ì‹œê°„ í˜„í™© ë° ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
3. **ì¶œì„ ì²´í¬ ì‹œìŠ¤í…œ** - QRì½”ë“œ ë˜ëŠ” ìˆ˜ë™ ì²´í¬

### Phase 3: ì•Œë¦¼ ë° ìµœì í™” (1ì£¼)
1. **ì´ë©”ì¼ ì•Œë¦¼ ì‹œìŠ¤í…œ** - ìë™ ì•Œë¦¼ ë°œì†¡
2. **ì„±ëŠ¥ ìµœì í™”** - í˜ì´ì§•, ìºì‹±, ë¹„ë™ê¸° ì²˜ë¦¬
3. **ëª¨ë°”ì¼ ìµœì í™”** - ë°˜ì‘í˜• ë””ìì¸

## ğŸ“ ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### 1. ë³´ì•ˆ
- CSRF í† í° ê²€ì¦ í•„ìˆ˜
- ê¸°ì—… ê¶Œí•œ ê²€ì¦ (ë³¸ì¸ ê°•ì˜ë§Œ ê´€ë¦¬)
- ê°œì¸ì •ë³´ ì²˜ë¦¬ ë¡œê·¸ ê¸°ë¡

### 2. ì„±ëŠ¥
- ëŒ€ìš©ëŸ‰ ì‹ ì²­ì ëª©ë¡ í˜ì´ì§• ì²˜ë¦¬
- í†µê³„ ë°ì´í„° ìºì‹±
- ì´ë©”ì¼ ë°œì†¡ í ì‹œìŠ¤í…œ

### 3. í™•ì¥ì„±
- í–‰ì‚¬ë³„ ë§ì¶¤ ì‹ ì²­ í¼ ì§€ì›
- ë‹¤ì–‘í•œ ê²°ì œ ë°©ì‹ ì—°ë™
- ì™¸ë¶€ ì‹œìŠ¤í…œ API ì—°ë™

## ğŸ“‚ ê´€ë ¨ íŒŒì¼

- `/workspace/database/add_registration_system.sql` - ì´ˆê¸° ì„¤ê³„ SQL
- `/workspace/database/fix_registration_system.sql` - ì˜¤ë¥˜ ìˆ˜ì • SQL
- `/workspace/database/update_existing_registrations_table.sql` - ìµœì¢… ì ìš© SQL

## âœ… ì™„ë£Œ í™•ì¸

```sql
-- í…Œì´ë¸” êµ¬ì¡° í™•ì¸
DESCRIBE lecture_registrations;

-- íŠ¸ë¦¬ê±° í™•ì¸  
SHOW TRIGGERS LIKE 'lecture_registrations';

-- ë·° í™•ì¸
SHOW FULL TABLES WHERE Table_type = 'VIEW';
```

**ê²°ê³¼**: ëª¨ë“  í…Œì´ë¸”, íŠ¸ë¦¬ê±°, ë·°ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì–´ ì‹ ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ë°ì´í„°ë² ì´ìŠ¤ ì¸í”„ë¼ê°€ ì™„ë²½í•˜ê²Œ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.