# ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… í‘œì¤€ ê°€ì´ë“œ

**ì‘ì„±ì¼:** 2025-06-19 KST  
**ìµœì¢… ìˆ˜ì •ì¼:** 2025-07-08 KST  
**ëª©ì :** íƒ‘ë§ˆì¼€íŒ… í”„ë¡œì íŠ¸ì˜ í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ì²´ê³„  
**ìƒíƒœ:** ì‹¤ì œ êµ¬í˜„ëœ íŒ¨í„´ ê¸°ë°˜ í‘œì¤€í™” ë¬¸ì„œ (v3.2.1 WebLogger ì¡°ê±´ë¶€ ì²˜ë¦¬ ë°˜ì˜)

---

## ğŸ¯ ì—ëŸ¬ ì²˜ë¦¬ ì² í•™

íƒ‘ë§ˆì¼€íŒ… í”Œë«í¼ì€ **ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€**ì™€ **ê°œë°œì ì¹œí™”ì  ë””ë²„ê¹… ì •ë³´**ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤.

### ê¸°ë³¸ ì›ì¹™
1. **ì‚¬ìš©ì**: ì´í•´í•˜ê¸° ì‰¬ìš´ í•œêµ­ì–´ ë©”ì‹œì§€
2. **ê°œë°œì**: ìƒì„¸í•œ ê¸°ìˆ ì  ì •ë³´ ë° ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
3. **ì‹œìŠ¤í…œ**: ìë™ ë³µêµ¬ ê°€ëŠ¥í•œ ì—ëŸ¬ëŠ” ì¬ì‹œë„
4. **ë³´ì•ˆ**: ë¯¼ê°í•œ ì •ë³´ëŠ” ë¡œê·¸ì—ì„œ ë§ˆìŠ¤í‚¹

---

## ğŸ—ï¸ ResponseHelper í‘œì¤€ íŒ¨í„´

### í†µí•© ì‘ë‹µ ì²˜ë¦¬ê¸°

#### ê¸°ë³¸ êµ¬ì¡°
```php
class ResponseHelper {
    const STATUS_SUCCESS = 'success';
    const STATUS_ERROR = 'error';
    const STATUS_WARNING = 'warning';
    
    public static function json($data = null, $status = 200, $message = '') {
        http_response_code($status);
        header('Content-Type: application/json; charset=utf-8');
        
        $response = [
            'status' => $status < 400 ? self::STATUS_SUCCESS : self::STATUS_ERROR,
            'data' => $data,
            'message' => $message,
            'timestamp' => date('c'),
            'request_id' => self::getRequestId()
        ];
        
        echo json_encode($response, JSON_UNESCAPED_UNICODE);
        exit;
    }
    
    public static function error($message, $code = 400, $details = null) {
        $response = [
            'status' => self::STATUS_ERROR,
            'error' => [
                'code' => $code,
                'message' => $message,
                'details' => $details,
                'timestamp' => date('c'),
                'request_id' => self::getRequestId()
            ]
        ];
        
        // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ìƒì„¸ ì—ëŸ¬ ì •ë³´ í¬í•¨
        if (getenv('APP_ENV') === 'development') {
            $response['error']['debug'] = [
                'file' => debug_backtrace()[0]['file'] ?? null,
                'line' => debug_backtrace()[0]['line'] ?? null,
                'trace' => debug_backtrace()
            ];
        }
        
        http_response_code($code);
        header('Content-Type: application/json; charset=utf-8');
        echo json_encode($response, JSON_UNESCAPED_UNICODE);
        exit;
    }
    
    public static function success($data = null, $message = 'ì„±ê³µ') {
        return self::json($data, 200, $message);
    }
    
    private static function getRequestId() {
        return $_SERVER['HTTP_X_REQUEST_ID'] ?? uniqid('req_', true);
    }
}
```

### ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

#### ì„±ê³µ ì‘ë‹µ
```php
// ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
$posts = Post::getPublishedPosts();
ResponseHelper::success($posts, 'ê²Œì‹œê¸€ì„ ì„±ê³µì ìœ¼ë¡œ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤.');

// ì‚¬ìš©ì ë“±ë¡ ì„±ê³µ
ResponseHelper::json([
    'user_id' => $userId,
    'redirect_url' => '/dashboard'
], 201, 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
```

#### ì—ëŸ¬ ì‘ë‹µ
```php
// ê¶Œí•œ ë¶€ì¡±
ResponseHelper::error('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', 403);

// ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨
ResponseHelper::error('ì…ë ¥ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 400, [
    'fields' => [
        'email' => 'ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        'password' => 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'
    ]
]);

// ì‹œìŠ¤í…œ ì—ëŸ¬
ResponseHelper::error('ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 500);
```

---

## ğŸ“Š ë¡œê¹… ì²´ê³„

### ë¡œê·¸ ë ˆë²¨ ì •ì˜

#### ë ˆë²¨ë³„ ê¸°ì¤€
```php
class LogLevel {
    const DEBUG = 100;      // ê°œë°œìš© ìƒì„¸ ì •ë³´
    const INFO = 200;       // ì¼ë°˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë²¤íŠ¸
    const NOTICE = 250;     // ì£¼ëª©í•  ë§Œí•œ ì´ë²¤íŠ¸
    const WARNING = 300;    // ê²½ê³  ìƒí™© (ì²˜ë¦¬ ê°€ëŠ¥í•œ ë¬¸ì œ)
    const ERROR = 400;      // ì˜¤ë¥˜ ìƒí™© (ì²˜ë¦¬ ê°€ëŠ¥í•œ ì˜¤ë¥˜)
    const CRITICAL = 500;   // ì‹¬ê°í•œ ì˜¤ë¥˜ (ì¦‰ì‹œ ëŒ€ì‘ í•„ìš”)
    const ALERT = 550;      // ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”
    const EMERGENCY = 600;  // ì‹œìŠ¤í…œ ì‚¬ìš© ë¶ˆê°€
}
```

### WebLogger í´ë˜ìŠ¤

#### ì¤‘ì•™ì§‘ì¤‘ì‹ ë¡œê±° (v3.2.1 ì¡°ê±´ë¶€ ì²˜ë¦¬ ë°©ì‹)
**ì¤‘ìš”**: v3.2.1ë¶€í„° WebLoggerëŠ” ì¡°ê±´ë¶€ ë¡œë”© ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë˜ì–´ í´ë˜ìŠ¤ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸ í›„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```php
class WebLogger {
    private static $logDir = '/var/log/topmkt/';
    private static $maxFileSize = 10 * 1024 * 1024; // 10MB
    
    public static function log($level, $message, $context = []) {
        $timestamp = date('Y-m-d H:i:s');
        $requestId = $_SERVER['HTTP_X_REQUEST_ID'] ?? uniqid('req_');
        $userId = $_SESSION['user_id'] ?? 'anonymous';
        $ip = self::getClientIp();
        
        // ë¯¼ê°í•œ ì •ë³´ ë§ˆìŠ¤í‚¹
        $context = self::maskSensitiveData($context);
        
        $logEntry = [
            'timestamp' => $timestamp,
            'level' => self::getLevelName($level),
            'message' => $message,
            'context' => $context,
            'request_id' => $requestId,
            'user_id' => $userId,
            'ip' => $ip,
            'url' => $_SERVER['REQUEST_URI'] ?? '',
            'method' => $_SERVER['REQUEST_METHOD'] ?? '',
            'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? ''
        ];
        
        $logLine = json_encode($logEntry, JSON_UNESCAPED_UNICODE) . "\n";
        
        // ë¡œê·¸ íŒŒì¼ ê²°ì •
        $logFile = self::getLogFile($level);
        
        // ë¡œê·¸ ë¡œí…Œì´ì…˜ í™•ì¸
        self::rotateLogIfNeeded($logFile);
        
        // ë¡œê·¸ ê¸°ë¡
        file_put_contents($logFile, $logLine, FILE_APPEND | LOCK_EX);
        
        // ì‹¬ê°í•œ ë ˆë²¨ì€ ì´ë©”ì¼ ì•Œë¦¼
        if ($level >= LogLevel::CRITICAL) {
            self::sendAlertEmail($logEntry);
        }
    }
    
    public static function debug($message, $context = []) {
        self::log(LogLevel::DEBUG, $message, $context);
    }
    
    public static function info($message, $context = []) {
        self::log(LogLevel::INFO, $message, $context);
    }
    
    public static function warning($message, $context = []) {
        self::log(LogLevel::WARNING, $message, $context);
    }
    
    public static function error($message, $context = []) {
        self::log(LogLevel::ERROR, $message, $context);
    }
    
    public static function critical($message, $context = []) {
        self::log(LogLevel::CRITICAL, $message, $context);
    }
    
    private static function maskSensitiveData($data) {
        $sensitiveKeys = ['password', 'token', 'api_key', 'secret', 'phone'];
        
        if (is_array($data)) {
            foreach ($data as $key => $value) {
                if (in_array(strtolower($key), $sensitiveKeys)) {
                    $data[$key] = '***MASKED***';
                } elseif (is_array($value)) {
                    $data[$key] = self::maskSensitiveData($value);
                }
            }
        }
        
        return $data;
    }
    
    private static function getLogFile($level) {
        $date = date('Y-m-d');
        
        switch ($level) {
            case LogLevel::DEBUG:
                return self::$logDir . "debug-{$date}.log";
            case LogLevel::INFO:
            case LogLevel::NOTICE:
                return self::$logDir . "info-{$date}.log";
            case LogLevel::WARNING:
                return self::$logDir . "warning-{$date}.log";
            case LogLevel::ERROR:
                return self::$logDir . "error-{$date}.log";
            case LogLevel::CRITICAL:
            case LogLevel::ALERT:
            case LogLevel::EMERGENCY:
                return self::$logDir . "critical-{$date}.log";
            default:
                return self::$logDir . "app-{$date}.log";
        }
    }
}
```

### WebLogger ì¡°ê±´ë¶€ ì‚¬ìš© íŒ¨í„´ (v3.2.1+)

#### ì•ˆì „í•œ WebLogger í˜¸ì¶œ
WebLogger í´ë˜ìŠ¤ê°€ í•­ìƒ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¡°ê±´ë¶€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤:

```php
// ResponseHelperì—ì„œì˜ ì•ˆì „í•œ WebLogger ì‚¬ìš©
class ResponseHelper {
    public static function json($data = null, $status = 200, $message = '') {
        // ... ì‘ë‹µ ì²˜ë¦¬ ë¡œì§
        
        // API í˜¸ì¶œ ë¡œê·¸ (WebLoggerê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ)
        if (class_exists('WebLogger')) {
            WebLogger::api($_SERVER['REQUEST_URI'] ?? '', $_SERVER['REQUEST_METHOD'] ?? '', null, $status);
        }
        
        echo json_encode($response, JSON_UNESCAPED_UNICODE);
        exit;
    }
}

// ì¼ë°˜ì ì¸ ë¡œê¹… ì‚¬ìš©ë²•
function safeLog($level, $message, $context = []) {
    if (class_exists('WebLogger')) {
        WebLogger::log($level, $message, $context);
    } else {
        // í´ë°±: ê¸°ë³¸ PHP ë¡œê·¸ ì‚¬ìš©
        error_log("[$level] $message " . json_encode($context));
    }
}

// í—¬í¼ í•¨ìˆ˜ë“¤
function safeLogDebug($message, $context = []) {
    if (class_exists('WebLogger')) {
        WebLogger::debug($message, $context);
    }
}

function safeLogError($message, $context = []) {
    if (class_exists('WebLogger')) {
        WebLogger::error($message, $context);
    } else {
        error_log("ERROR: $message " . json_encode($context));
    }
}
```

#### ê¶Œì¥ ì‚¬ìš© íŒ¨í„´
1. **ResponseHelper**: í•­ìƒ ì¡°ê±´ë¶€ í™•ì¸ í›„ ì‚¬ìš©
2. **ì»¨íŠ¸ë¡¤ëŸ¬**: ì¤‘ìš”í•œ ë¡œê·¸ëŠ” í´ë°± ë°©ì‹ ì œê³µ
3. **ì—ëŸ¬ í•¸ë“¤ëŸ¬**: WebLogger ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ error_log ì‚¬ìš©

### ë¡œê·¸ ì‚¬ìš© íŒ¨í„´

#### ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œì˜ ë¡œê·¸ ê¸°ë¡
```php
class LectureController {
    public function store() {
        $requestId = uniqid('lecture_store_');
        
        try {
            WebLogger::info('ê°•ì˜ ë“±ë¡ ì‹œì‘', [
                'request_id' => $requestId,
                'user_id' => $_SESSION['user_id'],
                'data_size' => strlen(json_encode($_POST))
            ]);
            
            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
            $lecture = $this->createLecture($_POST);
            
            WebLogger::info('ê°•ì˜ ë“±ë¡ ì™„ë£Œ', [
                'request_id' => $requestId,
                'lecture_id' => $lecture->id,
                'execution_time' => microtime(true) - $startTime
            ]);
            
            ResponseHelper::success(['lecture_id' => $lecture->id], 'ê°•ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
        } catch (ValidationException $e) {
            WebLogger::warning('ê°•ì˜ ë“±ë¡ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨', [
                'request_id' => $requestId,
                'errors' => $e->getErrors()
            ]);
            
            ResponseHelper::error('ì…ë ¥ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', 400, $e->getErrors());
            
        } catch (DatabaseException $e) {
            WebLogger::error('ê°•ì˜ ë“±ë¡ DB ì˜¤ë¥˜', [
                'request_id' => $requestId,
                'error' => $e->getMessage(),
                'sql' => $e->getSql()
            ]);
            
            ResponseHelper::error('ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 500);
            
        } catch (Exception $e) {
            WebLogger::critical('ê°•ì˜ ë“±ë¡ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜', [
                'request_id' => $requestId,
                'error' => $e->getMessage(),
                'trace' => $e->getTraceAsString()
            ]);
            
            ResponseHelper::error('ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.', 500);
        }
    }
}
```

---

## ğŸ” ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´

### ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤

#### ê¸°ë³¸ ì˜ˆì™¸ êµ¬ì¡°
```php
abstract class ApplicationException extends Exception {
    protected $context = [];
    protected $userMessage = '';
    
    public function __construct($message = '', $code = 0, $previous = null, $context = []) {
        parent::__construct($message, $code, $previous);
        $this->context = $context;
    }
    
    public function getContext() {
        return $this->context;
    }
    
    public function getUserMessage() {
        return $this->userMessage ?: $this->getMessage();
    }
    
    public function setUserMessage($message) {
        $this->userMessage = $message;
        return $this;
    }
}

class ValidationException extends ApplicationException {
    protected $errors = [];
    
    public function __construct($errors = [], $message = 'ë°ì´í„° ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.') {
        $this->errors = $errors;
        parent::__construct($message, 400);
        $this->userMessage = 'ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
    }
    
    public function getErrors() {
        return $this->errors;
    }
}

class DatabaseException extends ApplicationException {
    protected $sql = '';
    
    public function __construct($message, $sql = '', $code = 500) {
        $this->sql = $sql;
        parent::__construct($message, $code);
        $this->userMessage = 'ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
    }
    
    public function getSql() {
        return $this->sql;
    }
}

class AuthorizationException extends ApplicationException {
    public function __construct($message = 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', $code = 403) {
        parent::__construct($message, $code);
        $this->userMessage = 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
    }
}

class RateLimitException extends ApplicationException {
    public function __construct($message = 'ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.', $code = 429) {
        parent::__construct($message, $code);
        $this->userMessage = 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
    }
}
```

### ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬

#### ì¤‘ì•™ì§‘ì¤‘ì‹ ì˜ˆì™¸ ì²˜ë¦¬
```php
class GlobalErrorHandler {
    public static function register() {
        set_error_handler([self::class, 'handleError']);
        set_exception_handler([self::class, 'handleException']);
        register_shutdown_function([self::class, 'handleShutdown']);
    }
    
    public static function handleError($severity, $message, $file, $line) {
        if (!(error_reporting() & $severity)) {
            return false;
        }
        
        $errorLevel = self::mapErrorLevel($severity);
        
        WebLogger::log($errorLevel, 'PHP Error: ' . $message, [
            'file' => $file,
            'line' => $line,
            'severity' => $severity
        ]);
        
        // ì‹¬ê°í•œ ì˜¤ë¥˜ëŠ” ì˜ˆì™¸ë¡œ ë³€í™˜
        if ($severity & (E_ERROR | E_CORE_ERROR | E_COMPILE_ERROR | E_USER_ERROR)) {
            throw new ErrorException($message, 0, $severity, $file, $line);
        }
        
        return true;
    }
    
    public static function handleException($exception) {
        $isAjax = !empty($_SERVER['HTTP_X_REQUESTED_WITH']) && 
                  strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) === 'xmlhttprequest';
        
        if ($exception instanceof ApplicationException) {
            // ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ˆì™¸: ì‚¬ìš©ì ì¹œí™”ì  ì²˜ë¦¬
            WebLogger::warning('Application Exception', [
                'type' => get_class($exception),
                'message' => $exception->getMessage(),
                'context' => $exception->getContext()
            ]);
            
            if ($isAjax) {
                ResponseHelper::error(
                    $exception->getUserMessage(), 
                    $exception->getCode(),
                    $exception instanceof ValidationException ? $exception->getErrors() : null
                );
            } else {
                self::renderErrorPage($exception->getCode(), $exception->getUserMessage());
            }
        } else {
            // ì‹œìŠ¤í…œ ì˜ˆì™¸: ê¸°ìˆ ì  ì˜¤ë¥˜
            WebLogger::critical('System Exception', [
                'type' => get_class($exception),
                'message' => $exception->getMessage(),
                'file' => $exception->getFile(),
                'line' => $exception->getLine(),
                'trace' => $exception->getTraceAsString()
            ]);
            
            if ($isAjax) {
                ResponseHelper::error('ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 500);
            } else {
                self::renderErrorPage(500, 'ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    }
    
    public static function handleShutdown() {
        $error = error_get_last();
        
        if ($error && in_array($error['type'], [E_ERROR, E_CORE_ERROR, E_COMPILE_ERROR])) {
            WebLogger::critical('Fatal Error', [
                'message' => $error['message'],
                'file' => $error['file'],
                'line' => $error['line']
            ]);
            
            if (!headers_sent()) {
                http_response_code(500);
                echo 'ì‹œìŠ¤í…œì— ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        }
    }
}

// ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡
GlobalErrorHandler::register();
```

---

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

### ë¡œê·¸ ë¶„ì„ ë„êµ¬

#### ë¡œê·¸ íŒŒì„œ
```php
class LogAnalyzer {
    public static function getErrorStats($date = null) {
        $date = $date ?: date('Y-m-d');
        $logFile = "/var/log/topmkt/error-{$date}.log";
        
        if (!file_exists($logFile)) {
            return ['total' => 0, 'by_level' => [], 'by_hour' => []];
        }
        
        $lines = file($logFile, FILE_IGNORE_NEW_LINES);
        $stats = [
            'total' => 0,
            'by_level' => [],
            'by_hour' => [],
            'top_errors' => []
        ];
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if (!$data) continue;
            
            $stats['total']++;
            
            // ë ˆë²¨ë³„ í†µê³„
            $level = $data['level'] ?? 'unknown';
            $stats['by_level'][$level] = ($stats['by_level'][$level] ?? 0) + 1;
            
            // ì‹œê°„ë³„ í†µê³„
            $hour = substr($data['timestamp'], 11, 2);
            $stats['by_hour'][$hour] = ($stats['by_hour'][$hour] ?? 0) + 1;
            
            // ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬
            $message = $data['message'] ?? '';
            $stats['top_errors'][$message] = ($stats['top_errors'][$message] ?? 0) + 1;
        }
        
        // ìƒìœ„ ì—ëŸ¬ ì •ë ¬
        arsort($stats['top_errors']);
        $stats['top_errors'] = array_slice($stats['top_errors'], 0, 10, true);
        
        return $stats;
    }
    
    public static function detectAnomalies() {
        $currentHour = date('H');
        $stats = self::getErrorStats();
        
        $currentHourErrors = $stats['by_hour'][$currentHour] ?? 0;
        $avgErrors = array_sum($stats['by_hour']) / count($stats['by_hour']);
        
        // í‰ê· ì˜ 3ë°° ì´ìƒì´ë©´ ì´ìƒ ì§•í›„
        if ($currentHourErrors > $avgErrors * 3) {
            return [
                'anomaly_detected' => true,
                'current_errors' => $currentHourErrors,
                'average_errors' => round($avgErrors, 2),
                'threshold' => round($avgErrors * 3, 2)
            ];
        }
        
        return ['anomaly_detected' => false];
    }
}
```

### ì•Œë¦¼ ì‹œìŠ¤í…œ

#### ì‹¤ì‹œê°„ ì•Œë¦¼
```php
class AlertSystem {
    public static function sendCriticalAlert($logEntry) {
        $subject = '[CRITICAL] íƒ‘ë§ˆì¼€íŒ… ì‹œìŠ¤í…œ ì˜¤ë¥˜';
        $message = self::formatAlertMessage($logEntry);
        
        // ì´ë©”ì¼ ì•Œë¦¼
        self::sendEmail(getenv('ADMIN_EMAIL'), $subject, $message);
        
        // ìŠ¬ë™ ì•Œë¦¼ (ì„ íƒì )
        if (getenv('SLACK_WEBHOOK_URL')) {
            self::sendSlackAlert($logEntry);
        }
        
        // SMS ì•Œë¦¼ (ì‹¬ê°í•œ ê²½ìš°ë§Œ)
        if ($logEntry['level'] === 'EMERGENCY') {
            self::sendSMSAlert($logEntry);
        }
    }
    
    private static function formatAlertMessage($logEntry) {
        return "
ì‹œê°„: {$logEntry['timestamp']}
ë ˆë²¨: {$logEntry['level']}
ë©”ì‹œì§€: {$logEntry['message']}
ì‚¬ìš©ì: {$logEntry['user_id']}
URL: {$logEntry['url']}
IP: {$logEntry['ip']}
ìš”ì²­ ID: {$logEntry['request_id']}

ì»¨í…ìŠ¤íŠ¸:
" . json_encode($logEntry['context'], JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
    }
}
```

---

## ğŸ¯ ì—ëŸ¬ ì²˜ë¦¬ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ì—ëŸ¬ ë©”ì‹œì§€ ì‘ì„± ê°€ì´ë“œ

#### ì‚¬ìš©ì ë©”ì‹œì§€
```php
// âœ… ì¢‹ì€ ì˜ˆ
"ì…ë ¥í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”."
"íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
"ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."

// âŒ ë‚˜ìœ ì˜ˆ
"Validation failed for email field"
"File size exceeded maximum limit of 10485760 bytes"
"Database connection timeout error"
```

#### ê°œë°œì ë©”ì‹œì§€
```php
// âœ… ì¢‹ì€ ì˜ˆ
WebLogger::error('ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ì‹¤íŒ¨', [
    'email' => $email,
    'query' => $sql,
    'execution_time' => $queryTime
]);

// âŒ ë‚˜ìœ ì˜ˆ
WebLogger::error('Error occurred');
```

### 2. ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

#### ê³„ì¸µë³„ ì²˜ë¦¬
```php
// Model Layer: ë°ì´í„° ê²€ì¦
class User {
    public function create($data) {
        if (!$this->validate($data)) {
            throw new ValidationException($this->getValidationErrors());
        }
        
        try {
            return $this->insert($data);
        } catch (PDOException $e) {
            throw new DatabaseException('ì‚¬ìš©ì ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ', $e->getMessage());
        }
    }
}

// Controller Layer: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
class UserController {
    public function register() {
        try {
            $user = User::create($_POST);
            ResponseHelper::success(['user_id' => $user->id]);
        } catch (ValidationException $e) {
            ResponseHelper::error($e->getUserMessage(), 400, $e->getErrors());
        } catch (DatabaseException $e) {
            ResponseHelper::error($e->getUserMessage(), 500);
        }
    }
}
```

### 3. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

#### ì •ë³´ ë…¸ì¶œ ë°©ì§€
```php
class SecurityLogger {
    public static function logSecurityEvent($event, $data = []) {
        // ë¯¼ê°í•œ ì •ë³´ ì œê±°
        unset($data['password'], $data['token'], $data['api_key']);
        
        WebLogger::warning("Security Event: {$event}", [
            'data' => $data,
            'ip' => self::getClientIp(),
            'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? '',
            'referer' => $_SERVER['HTTP_REFERER'] ?? ''
        ]);
    }
}
```

---

## ğŸ”§ ê°œë°œ ë„êµ¬

### ë””ë²„ê·¸ ëª¨ë“œ

#### ê°œë°œ í™˜ê²½ ì„¤ì •
```php
if (getenv('APP_ENV') === 'development') {
    ini_set('display_errors', 1);
    ini_set('display_startup_errors', 1);
    error_reporting(E_ALL);
    
    // ë””ë²„ê·¸ ì •ë³´ ì¶”ê°€
    WebLogger::debug('Request received', [
        'method' => $_SERVER['REQUEST_METHOD'],
        'uri' => $_SERVER['REQUEST_URI'],
        'headers' => getallheaders(),
        'body' => file_get_contents('php://input')
    ]);
}
```

### ë¡œê·¸ ë·°ì–´

#### ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ ì—ëŸ¬ ë¡œê·¸ í™•ì¸
tail -f /var/log/topmkt/error-$(date +%Y-%m-%d).log | jq .

# íŠ¹ì • ì‚¬ìš©ìì˜ ë¡œê·¸ë§Œ í•„í„°ë§
grep '"user_id":"123"' /var/log/topmkt/info-$(date +%Y-%m-%d).log | jq .

# ì—ëŸ¬ í†µê³„ í™•ì¸
grep -c '"level":"ERROR"' /var/log/topmkt/error-$(date +%Y-%m-%d).log
```

---

**ì´ ë¬¸ì„œëŠ” ì‹¤ì œ ìš´ì˜ ì¤‘ì¸ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, AI ê°œë°œ ì‹œ ì•ˆì •ì ì´ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ ì½”ë“œ ì‘ì„±ì— í•„ìˆ˜ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.**